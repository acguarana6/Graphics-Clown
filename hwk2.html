<!-- This program builds a clown figure using the Three.js library and 3D
	objects. The flexibility of the clown is exhibited in the GUI, in which 
	users can toggle the sliders to change the dimensions of the clown.

	CS 307
	HW 2: Clown
	Written by Peyton Wang and Alex Chin
	Due: March 5, 2021
-->

<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>HW 2: Clown Three.js Application</title>
	<style>
		canvas {
			display: block;
			margin: 30px;
			width: 70%;
			height: 400px;
		}
	</style>
	<script src="https://cs.wellesley.edu/~cs307/threejs/libs/three-r95.all.js">
		"https://cs.wellesley.edu/~cs307/threejs/libs/three-r80.min.js"
	</script>
	<script src="https://cs.wellesley.edu/~cs307/threejs/libs/OrbitControls-r95.js">
		"https://cs.wellesley.edu/~cs307/threejs/libs/OrbitControls-r80.js"
	</script>
	<script src="https://cs.wellesley.edu/~cs307/threejs/libs/dat.gui-r95.js">
		"https://cs.wellesley.edu/~cs307/threejs/libs/dat.gui-r80.min.js"
	</script>
	<script src="https://cs.wellesley.edu/~cs307/threejs/libs/tw-sp21.js">
		"https://cs.wellesley.edu/~cs307/threejs/libs/tw-fa18.js"
	</script>
</head>

<body>
	<h1>HW 2: Clown Three.js Application</h1>

	<script>
		// defining colors for the clown
		var bodyColor = "dodgerblue";
		var headColor = "aquamarine";
		var eyesColor = "indigo"
		var legsColor = "magenta"
		var footColor = "springgreen"
		
		// defining materials for the clown
		var bodyMaterial = new THREE.MeshBasicMaterial({ color: bodyColor });
		var headMaterial = new THREE.MeshBasicMaterial({ color: headColor });
		var eyesMaterial = new THREE.MeshBasicMaterial({ color: eyesColor });
		var legsMaterial = new THREE.MeshBasicMaterial({ color: legsColor });
		var footMaterial = new THREE.MeshBasicMaterial({ color: footColor });

		
		/** 
		 * Returns a hat frame object created from hat rim and hat top geometries/meshes. 
		 * Input: dictionary of clown parameters.
		 */
		 function createHat(params) {
			var hatFrame = new THREE.Object3D();
			var hatBrimGeom = new THREE.CircleGeometry(params.hatBrimRadius, 32);
			var hatCrownGeom = new THREE.CylinderGeometry(params.hatTopRadius, params.hatBottomRadius, params.hatHeight, 64, 64);
			var hatBrimMesh = new THREE.Mesh(hatBrimGeom, bodyMaterial);
			var hatCrownMesh = new THREE.Mesh(hatCrownGeom, bodyMaterial);

			hatCrownMesh.position.y = params.headRadius + params.hatHeight/2 - 0.2;
			hatBrimMesh.position.y = params.headRadius - 0.2;
			hatBrimMesh.rotation.x = Math.PI/2;

			hatFrame.add(hatBrimMesh);
			hatFrame.add(hatCrownMesh);

			return hatFrame;
		}

		/** 
		 * Adds the hat frame object to the head. 
		 * Input: head object, dictionary of clown parameters.
		 */
		 function addHat(head, params) {
			var hatFrame = createHat(params);
			
			hatFrame.rotation.x = params.hatRotationX;
			hatFrame.rotation.y = params.hatRotationY;
			
			head.add(hatFrame);

			return head;
		}

		/** 
		 * Creates an eye geometry and returns an eye mesh. 
		 * Input: dictionary of clown parameters.
		 */
		 function createEye(params) {
			var eyeGeom = new THREE.SphereGeometry(params.eyeRadius, 32, 32);
			var eyeMesh = new THREE.Mesh(eyeGeom, eyesMaterial);

			return eyeMesh;
		}

		/** 
		 * Adds the eye mesh to the eye frame object, then adds the eye object to the head. 
		 * Input: head object, dictionary of clown parameters, and side (left = 1, right = -1).
		 */
		 function addEye(head, params, side) {
			var eyeFrame = new THREE.Object3D();
			var eyeMesh = createEye(params);

			eyeMesh.position.z = params.headRadius;
			eyeFrame.rotation.x = params.eyeRotationX
			eyeFrame.rotation.y = side * params.eyeRotationY;

			eyeFrame.add(eyeMesh);
			head.add(eyeFrame);
		}

		/** 
		 * Creates a nose geometry and returns a nose mesh. 
		 * Input: dictionary of clown parameters.
		 */
		 function createNose(params) {
			var noseGeom = new THREE.SphereGeometry(params.noseRadius, 32, 32);
			var noseMesh = new THREE.Mesh(noseGeom, eyesMaterial);

			return noseMesh;
		}

		/** 
		 * Adds the nose mesh to the nose frame object, then adds the nose object to the head. 
		 * Input: head object, dictionary of clown parameters.
		 */
		 function addNose(head, params) {
			var noseFrame = new THREE.Object3D();
			var noseMesh = createNose(params);
			
			noseMesh.position.z = params.headRadius;
			noseFrame.add(noseMesh);
			noseFrame.rotation.x = params.noseRotation;
			
			head.add(noseFrame);

			return head;
		}

		/** 
		 * Creates an ear geometry and returns an ear mesh. 
		 * Input: dictionary of clown parameters.
		 */
		 function createEar(params) {
			var earGeom = new THREE.SphereGeometry(params.earRadius, 32, 32);
			var earMesh = new THREE.Mesh(earGeom, eyesMaterial);
			earMesh.scale.z = params.earScale;

			return earMesh;
		}

		/** 
		 * Adds the ear mesh to the ear frame object, then adds the ear object to the head. 
		 * Input: head object, dictionary of clown parameters, and side (left = 1, right = -1).
		 */
		 function addEar(head, params, side) {
			var earFrame = new THREE.Object3D();
			var earMesh = createEar(params);

			earMesh.position.x = side * params.headRadius;
			earFrame.rotation.z = side *  params.earRotation;

			earFrame.add(earMesh);
			head.add(earFrame);
		}
		
		/** 
		 * Creates a mouth geometry and returns a mouth mesh. 
		 * Input: dictionary of clown parameters.
		 */
		 function createMouth(params) {
			var mouthGeom = new THREE.TorusGeometry(params.mouthRadius, params.mouthWidth, 30, 200, -params.mouthArcLength);
			var mouthMesh = new THREE.Mesh(mouthGeom, legsMaterial);

			return mouthMesh;
		}

		/** 
		 * Adds the mouth mesh to the mouth frame object, then adds the mouth object to the head. 
		 * Input: head object, dictionary of clown parameters.
		 */
		 function addMouth(head, params) {
			var mouthFrame = new THREE.Object3D();
			var mouthMesh = createMouth(params);
			
			mouthMesh.position.z = params.headRadius + 0.2;
			mouthFrame.rotation.x = params.mouthRotation;

			mouthFrame.add(mouthMesh);
			head.add(mouthFrame);
		}

		/** 
		 * Adds the head mesh to the head frame object, then adds the head object components to the head. 
		 * Input: dictionary of clown parameters.
		 */
		function createHead(params) {
			var headFrame = new THREE.Object3D();
			var headGeom = new THREE.SphereGeometry(params.headRadius, 32, 32);
			var headMesh = new THREE.Mesh(headGeom, headMaterial);
			
			headFrame.add(headMesh);
			
			addNose(headFrame, params);
			addMouth(headFrame, params);
			addEar(headFrame, params, 1);
			addEar(headFrame, params, -1);
			addEye(headFrame, params, 1);
			addEye(headFrame, params, -1);
			addHat(headFrame, params);
			
			return headFrame;
		}

		/** 
		 * Builds a arm frame object by creating a limb and adds it to the body. 
		 * Input: body object, dictionary of clown parameters, and side (left = 1, right = -1).
		 */
		function addArm(body, params, side) {
			var armFrame = createLimb(params.armRadiusTop, params.armRadiusBottom, params.armLength, bodyMaterial, params);

			armFrame.position.set(side * params.shoulderWidth, params.shoulderHeight, 0);
			armFrame.rotation.z = side * Math.PI / 2;
			
			body.add(armFrame);
		}

		/** 
		 * Builds a leg frame object by creating a limb and adds it to the body. 
		 * Input: leg object, dictionary of clown parameters, and side (left = 1, right = -1).
		 */
		function addLeg(body, params, side) {
			var legFrame = createLimb(params.legRadiusTop, params.legRadiusBottom, params.legLength, legsMaterial, params);
			legFrame.position.set(side * params.hipWidth, params.hipHeight, 0);
			
			addFoot(legFrame, params, side);
			
			body.add(legFrame);
		}

		/** 
		 * Adds the limb mesh to the limb frame object and returns the limb object.
		 * Input: limb dimensions (radii and length), limb material, and dictionary of clown parameters.
		 */
		function createLimb(radiusTop, radiusBottom, length, limbMaterial, params) {
			var limbFrame = new THREE.Object3D();
			var limbGeom = new THREE.CylinderGeometry(radiusTop, radiusBottom, length, 64, 64);
			var limbMesh = new THREE.Mesh(limbGeom, limbMaterial);
			
			limbMesh.position.y = -length / 2;
			limbFrame.add(limbMesh);

			return limbFrame;
		}

		/** 
		 * Creates a foot geometry and returns a foot mesh. 
		 * Input: dictionary of clown parameters.
		 */
		function createFoot(params) {
			var footGeom = new THREE.SphereGeometry(params.footRadius, 32, 32, 0, 6, 0, 1.5);
			var footMesh = new THREE.Mesh(footGeom, footMaterial);

			return footMesh;
		}

		/** 
		 * Adds the foot mesh to the foot frame object, then adds the foot object to the leg. 
		 * Input: leg object, dictionary of clown parameters.
		 */
		function addFoot(leg, params) {
			var footFrame = new THREE.Object3D();
			var footMesh = createFoot(params);

			footFrame.add(footMesh);
			
			footFrame.position.y = -params.legLength;
			
			leg.add(footFrame);
		}

		/** 
		 * Adds the body mesh to the body frame object, then adds the body object components to the body. 
		 * Input: dictionary of clown parameters.
		 */
		function createBody(params) {
			var bodyFrame = new THREE.Object3D();
			var bodyGeom = new THREE.SphereGeometry(params.bodyRadiusX, 32, 32);
			var bodyMesh = new THREE.Mesh(bodyGeom, bodyMaterial);
			
			bodyFrame.add(bodyMesh);

			addArm(bodyFrame, params, 1);
			addArm(bodyFrame, params, -1);
			addLeg(bodyFrame, params, 1);
			addLeg(bodyFrame, params, -1);

			bodyMesh.scale.y = params.bodyRadiusY;

			return bodyFrame;
		}

		/** 
		 * Adds the body and head meshes to the clown frame object, then returns the clown object. 
		 * Input: dictionary of clown parameters.
		 */
		function createClown(params) {
			var clownFrame = new THREE.Object3D();
			var bodyMesh = createBody(params);
			var headMesh = createHead(params);
			
			var bodyHeight = params.bodyRadiusY;
			var bodyRadiusX = params.bodyRadiusX;
			var headRadius = params.headRadius;
			
			headMesh.position.y = bodyHeight * bodyRadiusX + headRadius - 0.5;
			
			clownFrame.add(bodyMesh);
			clownFrame.add(headMesh);
			
			return clownFrame;
		}

		var clown;  // global variable for the clown object (will be modified upon toggling the slider)

		function addClown(params) {
			clown = createClown(params);
			scene.add(clown);
			clown.position.set(0, 15, 0);
		}

		// ====================================================================

		var scene = new THREE.Scene();  // creates the scene

		// creating origin with yellow dot and adding it to the scene
		var originRadius = 0.5;
		var originGeom = new THREE.SphereGeometry(originRadius, 32, 32);
		var originMaterial = new THREE.MeshBasicMaterial({ color: "yellow", side: THREE.DoubleSide });
		var originMesh = new THREE.Mesh(originGeom, originMaterial);
		scene.add(originMesh);

		// global dictionary of clown parameters
		var clownParams = {
			headRadius: 3.5,
			bodyRadiusX: 5,
			bodyRadiusY: 1.5,

			hatHeight: 3,
			hatTopRadius: 3, 
			hatBottomRadius: 2, 
			hatBrimRadius: 4, 
			hatRotationX: -0.3,
			hatRotationY: 1.4,

			eyeRadius: 0.3,
			eyeRotationX: -0.2,
			eyeRotationY: 0.35,

			noseRadius: 0.3,
			noseRotation: -0.01,

			mouthRadius: 0.6,
			mouthWidth: 0.2,
			mouthArcLength: 2.7,
			mouthRotation: 0.3,

			earRadius: 1,
			earScale: 0.5,
			earRotation: 0.1,

			armLength: 7,
			armRadiusTop: 0.7,
			armRadiusBottom: 0.7,
			armRotation: 0.7,

			shoulderWidth: 2.5,
			shoulderHeight: 5.25,

			hipWidth: 2.2,
			hipHeight: -6,

			legLength: 9,
			legRadiusTop: 0.7,
			legRadiusBottom: 0.7,
			footRadius: 1.5
		}
		
		addClown(clownParams);

		// ====================================================================
		
		/** 
		 * Callback function that redraws the clown with the new dimensions. 
		 */
		function redrawClown() {
    		scene.remove(clown);
    		addClown(clownParams);
    		state.render();
		}

		// sets up sliders to control the box dimensions
		var gui = new dat.GUI();
		gui.add(clownParams, 'headRadius', 2, 5).onChange(redrawClown);
		gui.add(clownParams, 'bodyRadiusX', 3, 7).onChange(redrawClown);
		gui.add(clownParams, 'bodyRadiusY', 1, 3).onChange(redrawClown);
		
		var hatFolder = gui.addFolder('hat');
		hatFolder.add(clownParams, 'hatHeight', 2, 5).onChange(redrawClown);
		hatFolder.add(clownParams, 'hatTopRadius', 2, 5).onChange(redrawClown);
		hatFolder.add(clownParams, 'hatBottomRadius', 1, 4).onChange(redrawClown);
		hatFolder.add(clownParams, 'hatBrimRadius', 3, 5).onChange(redrawClown);
		hatFolder.add(clownParams, 'hatRotationX', -0.5, 1).onChange(redrawClown);
		hatFolder.add(clownParams, 'hatRotationY', 0, 2).onChange(redrawClown);
		
		var eyesFolder = gui.addFolder('eyes');
		eyesFolder.add(clownParams, 'eyeRadius', -0.5, 1).onChange(redrawClown);
		eyesFolder.add(clownParams, 'eyeRotationX', -0.5, 0).onChange(redrawClown);
		eyesFolder.add(clownParams, 'eyeRotationY', 0, 0.5).onChange(redrawClown);
		
		var noseFolder = gui.addFolder('nose');
		noseFolder.add(clownParams, 'noseRadius', 0.1, 0.5).onChange(redrawClown);
		noseFolder.add(clownParams, 'noseRotation', -0.3, 0.5).onChange(redrawClown);
		
		var mouthFolder = gui.addFolder('mouth');
		mouthFolder.add(clownParams, 'mouthRadius', 0.2, 1).onChange(redrawClown);
		mouthFolder.add(clownParams, 'mouthWidth', 0.1, 0.5).onChange(redrawClown);
		mouthFolder.add(clownParams, 'mouthArcLength', 2, 3.5).onChange(redrawClown);
		mouthFolder.add(clownParams, 'mouthRotation', 0, 0.5).onChange(redrawClown);

		var earsFolder = gui.addFolder('ears');
		earsFolder.add(clownParams, 'earRadius', 0.5, 1.5).onChange(redrawClown);
		earsFolder.add(clownParams, 'earScale', 0.2, 1).onChange(redrawClown);
		earsFolder.add(clownParams, 'earRotation', 0, 0.5).onChange(redrawClown);

		var armsFolder = gui.addFolder('arms');
		armsFolder.add(clownParams, 'armLength', 5, 10).onChange(redrawClown);
		armsFolder.add(clownParams, 'armRadiusTop', 0.2, 1.5).onChange(redrawClown);
		armsFolder.add(clownParams, 'armRadiusBottom', 0.2, 1.5).onChange(redrawClown);
		armsFolder.add(clownParams, 'armRotation', 0, 1).onChange(redrawClown);

		var shouldersFolder = gui.addFolder('shoulders');
		shouldersFolder.add(clownParams, 'shoulderWidth', 1, 5).onChange(redrawClown);
		shouldersFolder.add(clownParams, 'shoulderHeight', 3, 7).onChange(redrawClown);

		var hipsFolder = gui.addFolder('hips');
		hipsFolder.add(clownParams, 'hipWidth', 4, 7).onChange(redrawClown);
		hipsFolder.add(clownParams, 'hipHeight', -8, 4).onChange(redrawClown);

		var legsFolder = gui.addFolder('legs');
		legsFolder.add(clownParams, 'legLength', 3, 12).onChange(redrawClown);
		legsFolder.add(clownParams, 'legRadiusTop', 0.3, 2).onChange(redrawClown);
		legsFolder.add(clownParams, 'legRadiusBottom', 0.3, 2).onChange(redrawClown);
		legsFolder.add(clownParams, 'footRadius', 0.3, 2).onChange(redrawClown);

		// ====================================================================

		// creates a renderer
		var renderer = new THREE.WebGLRenderer();

		TW.mainInit(renderer, scene);

		// uses a default orbiting camera
		state = TW.cameraSetup(renderer,
			scene,
			{
				minx: -10, maxx: 10,
				miny: -5, maxy: 40,
				minz: -10, maxz: 10
			}
		);
	</script>
</body>

</html>
